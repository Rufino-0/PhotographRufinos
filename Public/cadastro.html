<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Photograph | Cadastro</title>
  <script src="./js/sessao.js"></script>
  <link rel="stylesheet" href="./css/cadastro.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Flex:opsz,wght@8..144,200..1000&display=swap"
    rel="stylesheet">
</head>

<body>

  <div class="content">
    <div class="primeiro">
      <!-- entrada de dados e primeira parte da tela inserção 25/07/24  -->
      <div class="content1">
        <h1>SEJA BEM-VINDO!</h1>
        <h3>Primeiro acesso, insira os dados:</h3>
        <div>

          <input id="nome_input" placeholder="Nome*" type="text" required>
          <p id="alerta1" class="alerta"></p>

          <input id="sobrenome_input" placeholder="Sobrenome*" type="text" required>
          <p id="alerta2" class="alerta"></p>
        </div>
        <div>
          <!-- botões de interatividade usando parametros - alteração 26/07/24 -->
          <button onclick="cancelar(1)" class="Voltar">Cancelar</button>
          <button onclick="proxima(1)" class="proxima1">Próxima</button>
        </div>
      </div>
    </div>
    <div class="segundo">
      <div class="content1">
        <h1>SEJA BEM-VINDO!</h1>
        <h3>Primeiro acesso, insira os dados:</h3>
        <div>

          <input id="email_input" placeholder="E-mail*" type="email" required>
          <p id="alerta3" class="alerta"></p>
        </div>
        <div>

          <input id="emailConfirmacao_input" placeholder="Confirme seu E-mail*" type="email" required>
          <p id="alerta4" class="alerta"></p>
        </div>
        <div>
          <!-- botões que para voltar e avançar para tela seguinte - inserção 26/07/24 -->
          <button onclick="cancelar(2)" class="cancelar1">Voltar</button>
          <button onclick="proxima(2)" class="proxima2">Proxima</button>
        </div>
      </div>
    </div>
    <div class="terceiro">
      <div class="content1">
        <h1>SEJA BEM-VINDO!</h1>
        <h3>Primeiro acesso, insira os dados:</h3>
        <div>

          <input id="senha_input" placeholder="Senha *" type="password">
          <button onclick="exibir(1)" id="senhasBtn1"><img class="senhas1"
              src="./assets/cadastro/olhoAberto.png" alt="Olho da Senha"></button>
          <button onclick="exibir(2)" id="senhasBtn2"><img class="senhas2" src="./assets/cadastro/olhoRisco.png"
              alt="Olho da Senha"></button>
          <p id="alerta5" class="alerta"></p>
        </div>
        <div class="verificacao">

          <!-- textos de verificação para a senha alteração 26/07/24 -->

          <li>
            <span id="aviso1">Conter pelo menos 8 caracteres</span>
          </li>
          <li>

            <span id="aviso2">conter pelo menos uma letra maiúscula (A...Z)</span>
          </li>
          <li>

            <span id="aviso3">conter pelo menos uma letra minúscula (a...z) </span>
          </li>
          <li>

            <span id="aviso4">conter pelo menos um número (0-9)</span>
          </li>
          <li>

            <span id="aviso5">conter pelo menos um caractere especial. (! @ # $ &)</span>
          </li>
        </div>
        <div>

          <input id="confirmacao_senha_input" placeholder="Confirme sua Senha *" type="password">
          <button onclick="exibir(3)" id="senhasBtn3"><img class="senhas1"
              src="./assets/cadastro/olhoAberto.png" alt="Olho da Senha"></button>
          <button onclick="exibir(4)" id="senhasBtn4"><img class="senhas2" src="./assets/cadastro/olhoRisco.png"
              alt="Olho da Senha"></button>
          <p id="alerta6" class="alerta"></p>

        </div>
        <div>
          <button onclick="cancelar(3)" class="Voltar">Cancelar</button>
          <button onclick="proxima(3)" class="proxima2">Cadastrar</button>
        </div>
      </div>
    </div>

    <div class="confirmacao">
      <img src="./assets/cadastro/icons8-certo.gif" alt="">
      <h2>Cadastro realizado com sucesso!</h2>
      <span>Redirecionando para Login...</span>
    </div>

  </div>

</body>

</html>

<script>

  // função que faz a troca de todas as telas usando parametros - inserção 26/07/24

  function proxima(resposta) {

    // declarando as inputs - inserção 26/07/24

    let nome = nome_input.value;
    let sobrenome = sobrenome_input.value;
    let email = email_input.value;
    let confirmacaoEmmail = emailConfirmacao_input.value;
    let senha = senha_input.value;
    let confirmacaoSenha = confirmacao_senha_input.value;

    // o sistema funciona de uma forma simples onde o botão vem com o parametro indicando em qual tela ele está e indicando para onde ele deve ir depois
    // e dentro de cada tela cada campo tem sua própria verificação para ter uma maior segurança - inserção 26/07/24


    if (resposta === 1) {

      // validações da primeira tela - inserção 26/07/24

      if (nome == '') {

        alerta1.innerHTML = "Preencha o campo nome!"

        setTimeout(function () {
          alerta1.innerHTML = '';
        }, 2000);

      } else if (sobrenome == '') {
        alerta2.innerHTML = "Preencha o campo sobrenome!"

        setTimeout(function () {
          alerta2.innerHTML = '';
        }, 1500);
      } else if (nome.length <= 2) {

        alerta1.innerHTML = "O nome deve conter mais de 2 caracteres!"

        setTimeout(function () {
          alerta1.innerHTML = '';
        }, 1500);

      } else if (sobrenome.length <= 2) {

        alerta2.innerHTML = "O sobrenome deve conter mais de 2 caracteres!"

        setTimeout(function () {
          alerta2.innerHTML = '';
        }, 1500);

      } else {

        document.querySelector('.primeiro').style.display = 'none';
        document.querySelector('.segundo').style.display = 'flex';

      };

    } else if (resposta === 2) {

      // validações da segunda tela - inserção 26/07/24

      if (email == '') {

        alerta3.innerHTML = "Preencha o campo E-mail!"

        setTimeout(function () {
          alerta3.innerHTML = '';
        }, 1500);

      } else if (confirmacaoEmmail == '') {

        alerta4.innerHTML = "Preencha o campo confirmar E-mail!"

        setTimeout(function () {
          alerta4.innerHTML = '';
        }, 1500);

      } else if (email.indexOf('@') == -1 || email.indexOf('.com') == -1) {

        alerta3.innerHTML = "Digite um E-mail válido!"

        setTimeout(function () {
          alerta3.innerHTML = '';
        }, 1500);

      } else if (email !== confirmacaoEmmail) {

        alerta4.innerHTML = "Os E-mails não conferem!"

        setTimeout(function () {
          alerta4.innerHTML = '';
        }, 1500);

      } else {

        document.querySelector('.segundo').style.display = 'none';
        document.querySelector('.terceiro').style.display = 'flex';

      };

    } else if (resposta === 3) {

      // validações da terceira tela - inserção 26/07/24

      if (senha == '') {

        alerta5.innerHTML = "Preencha o campo senha!"

        setTimeout(function () {
          alerta5.innerHTML = '';
        }, 1500);

      } else if (confirmacaoSenha == '') {

        alerta6.innerHTML = "Preencha o campo Confirmação de Campo!"

        setTimeout(function () {
          alerta6.innerHTML = '';
        }, 1500);

      } else if (senha != confirmacaoSenha) {

        alerta6.innerHTML = "As senhas não conferem!"

      } else {

        // caso todas as verificações batam com os if e elses ele chama a função cadastrar passando um parametro de aprovação 

        cadastrar(1);

      }

    }
  }

  // função para o usuario poder ir e voltar durante seu cadastro - inserção 26/07/24

  function cancelar(resposta) {

    // usando para dar uma maior segunrança eu usei um confirm para poder ajudar o usuario a ter certeza do que ele quer escolher - inserção 26/07/24
    // passei parametros para indicar em qual tela ele está e para onde ele deve ir - inserção 26/07/24

    if (resposta === 1) {

      if (confirm('Deseja cancelar? Você será redirecionado para a página inicial')) {

        window.location = 'index.html'

      } else {

      }

    } else if (resposta === 2) {

      // troca de telas - inserção 26/07/24

      document.querySelector('.segundo').style.display = 'none';
      document.querySelector('.primeiro').style.display = 'flex';

    } else if (resposta === 3) {

      if (confirm('Deseja cancelar? Você terá que preencher novamente os dados')) {

        window.location = 'index.html'

      } else {

      }

    }

  }


  function exibir(resposta) {

    if (resposta == 1) {

      document.getElementById('senhasBtn1').style.display = 'none'
      document.getElementById('senhasBtn2').style.display = 'flex'
      document.getElementById('senha_input').type = 'text'

    } else if (resposta == 2) {

      document.getElementById('senhasBtn2').style.display = 'none'
      document.getElementById('senhasBtn1').style.display = 'flex'
      document.getElementById('senha_input').type = 'password'
    } else if (resposta == 3) {

      document.getElementById('senhasBtn3').style.display = 'none'
      document.getElementById('senhasBtn4').style.display = 'flex'
      document.getElementById('confirmacao_senha_input').type = 'text'

    } else if (resposta == 4) {

      document.getElementById('senhasBtn4').style.display = 'none'
      document.getElementById('senhasBtn3').style.display = 'flex'
      document.getElementById('confirmacao_senha_input').type = 'password'

    }

  }

  let ax = 0
  // declarando a variavel para pegar o elemento em HTML - inserção 25/07/24
  let VerificarSenha = document.getElementById('senha_input');

  function verificar() {

    senha = document.getElementById('senha_input').value;
    // verifica se a senha tem uma letra maiúcula de A até Z - inserção 25/07/24
    let maiuscula = /[A-Z]/.test(senha);
    // verifica se a senha tem uma letra minúscula de a até z - inserção 25/07/24
    let minuscula = /[a-z]/.test(senha);
    // verifica se a senha tem um número de 0 até 9 - inserção 25/07/24
    let num = /[0-9]/.test(senha);
    // verifica se a senha tem um caractere especial - inserção 25/07/24
    let especial = /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/.test(senha);
    // verifica se a senha tem pelo menos 8 caracteres - inserção 25/07/24
    let tamanho = 8;

    // validações para fortificar a senha inserção - 25/07/24
    if (senha.length >= tamanho) {
      aviso1.style.color = 'green';
    }
    if (maiuscula) {
      aviso2.style.color = 'green';
    }
    if (minuscula) {
      aviso3.style.color = 'green';
    }
    if (num) {
      aviso4.style.color = 'green';
    }
    if (especial) {
      aviso5.style.color = 'green';
    }
  }
  
  //a cada vez que a input tiver uma mudança, ele chama a função verificar - inserção 25/07/24  
  VerificarSenha.addEventListener('input', verificar)


  function cadastrar(resposta) {
    // declarando variáveis para o cadastro alteração 02/08/24
    let nomeCad = nome_input.value;
    let sobrenomeCad = sobrenome_input.value;
    let emailCad = email_input.value;
    let senhaCad = senha_input.value;
    let avaliacao = 'false'

    if (resposta == 1) {

      // Enviando o valor da nova input
      fetch("/usuarios/cadastrar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          // dados vindos do html para serem enviados ao controller - alterçao 26/07/24
          nomeServer: nomeCad,
          sobrenomeServer: sobrenomeCad,
          emailServer: emailCad,
          senhaServer: senhaCad,
          avaliacaoServer: avaliacao
        }),
      })
        .then(function (resposta) {
          console.log("resposta: ", resposta);

          if (resposta.ok) {
           
            document.querySelector('.confirmacao').style.display = 'flex';
            setTimeout(() => {
              window.location = "login.html";
            }, "1500");

          } else {
            throw "Houve um erro ao tentar realizar o cadastro!";
          }
        })
        .catch(function (resposta) {
          console.log(`#ERRO: ${resposta}`);

        });

      return false;
    }
  }


</script>